@model CmsTools.Models.SchemaTreeViewModel

<div class="cmstree bg-light h-100">
    <div class="p-2 border-bottom schema-tree-header">
        <strong class="small text-uppercase text-muted">Connections</strong>
    </div>

    @if (Model.Items == null || Model.Items.Count == 0)
    {
        <div class="p-2 small text-muted">
            Chưa có bảng nào được cấp quyền xem.
        </div>
    }
    else
    {
        <div class="accordion accordion-flush" id="cmsTreeAccordion">
            @{
                var idx = 0;
            }

            @foreach (var node in Model.Items)
            {
                var connId = node.Connection.Id;
                var headingId = $"cms-conn-{connId}-head";
                var collapseId = $"cms-conn-{connId}-body";
                var expanded = idx == 0; // mở connection đầu tiên
                idx++;

                <div class="accordion-item">
                    <h2 class="accordion-header" id="@headingId">
                        <button class="accordion-button @(expanded ? "" : "collapsed") small"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#@collapseId"
                                aria-expanded="@(expanded.ToString().ToLower())"
                                aria-controls="@collapseId">
                            @node.Connection.Name
                        </button>
                    </h2>
                    <div id="@collapseId"
                         class="accordion-collapse collapse @(expanded ? "show" : "")"
                         aria-labelledby="@headingId"
                         data-bs-parent="#cmsTreeAccordion">
                        <div class="accordion-body p-0">
                            <ul class="list-group list-group-flush cmstree-tables">
                                @foreach (var t in node.Tables)
                                {
                                    var isActive = Model.CurrentTableId.HasValue
                                    && Model.CurrentTableId.Value == t.Id;

                                    <li class="list-group-item list-group-item-action px-2 py-1 @(isActive ? "active" : "")">
                                        <a class="d-flex justify-content-between align-items-center text-decoration-none @(isActive ? "text-white" : "")"
                                           href="/Data/List?tableId=@t.Id">
                                            <span class="small text-truncate me-2">
                                                @(t.DisplayName ?? t.TableName)
                                            </span>
                                            <span class="badge bg-secondary bg-opacity-50 text-wrap schema-badge-schema">
                                                @t.SchemaName.@t.TableName
                                            </span>
                                        </a>
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
