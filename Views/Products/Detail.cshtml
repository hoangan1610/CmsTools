@model CmsTools.Models.ProductDetailViewModel
@using System.Globalization

@{
    ViewData["Title"] = "Product detail - " + Model.Product.Name;
}

<h2 class="mt-3 mb-3">
    @Model.Product.Name
    <small class="text-muted">(@Model.Product.Id)</small>
</h2>

<div class="row mb-4">
    <div class="col-md-8">
        <dl class="row">
            <dt class="col-sm-3">Brand</dt>
            <dd class="col-sm-9">@Model.Product.BrandName</dd>

            <dt class="col-sm-3">Tag</dt>
            <dd class="col-sm-9">@Model.Product.Tag</dd>

            <dt class="col-sm-3">Keyword</dt>
            <dd class="col-sm-9">@Model.Product.ProductKeyword</dd>

            <dt class="col-sm-3">Status</dt>
            <dd class="col-sm-9">
                @if (Model.Product.Status == 1)
                {
                    <span class="badge bg-success">Active</span>
                }
                else
                {
                    <span class="badge bg-secondary">Inactive</span>
                }
            </dd>

            <dt class="col-sm-3">Created</dt>
            <dd class="col-sm-9">
                @Model.Product.CreatedAt.ToString("dd/MM/yyyy HH:mm", CultureInfo.CurrentCulture)
            </dd>

            <dt class="col-sm-3">Updated</dt>
            <dd class="col-sm-9">
                @Model.Product.UpdatedAt.ToString("dd/MM/yyyy HH:mm", CultureInfo.CurrentCulture)
            </dd>
        </dl>
    </div>
    <div class="col-md-4">
        @if (!string.IsNullOrWhiteSpace(Model.Product.ImageProduct))
        {
            <div class="text-center">
                <img src="@Model.Product.ImageProduct"
                     alt="Product image"
                     style="max-width:200px;max-height:200px;object-fit:contain;" />
            </div>
        }
    </div>
</div>

<h4>Variants</h4>

<p>
    <a class="btn btn-sm btn-success"
       asp-controller="Products"
       asp-action="CreateVariant"
       asp-route-productId="@Model.Product.Id">
        + Thêm variant
    </a>
</p>

@if (Model.Variants == null || !Model.Variants.Any())
{
    <p class="text-muted">Sản phẩm chưa có variant nào.</p>
}
else
{
    <div class="table-responsive">
        <table class="table table-sm table-bordered align-middle">
            <thead class="table-light">
                <tr>
                    <th style="width:70px;">ID</th>
                    <th>Tên</th>
                    <th>SKU</th>
                    <th>Ảnh</th>
                    <th class="text-end">Giá bán</th>
                    <th class="text-end">Tồn kho</th>
                    <th style="width:100px;">Trạng thái</th>
                    <th style="width:200px;">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var v in Model.Variants)
                {
                    <tr>
                        <td>@v.Id</td>
                        <td>@(v.Name ?? "")</td>
                        <td>@v.Sku</td>
                        <td>
                            @if (!string.IsNullOrWhiteSpace(v.Image))
                            {
                                <a href="@v.Image" target="_blank" rel="noopener noreferrer">
                                    <img src="@v.Image"
                                         alt="variant"
                                         style="max-height:40px;max-width:80px;object-fit:contain;" />
                                </a>
                            }
                        </td>
                        <td class="text-end">
                            @v.RetailPrice.ToString("N0", CultureInfo.CurrentCulture)
                        </td>
                        <td class="text-end">@v.Stock</td>
                        <td>
                            @if (v.Status == 1)
                            {
                                <span class="badge bg-success">Active</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">Inactive</span>
                            }
                        </td>
                        <td>
                            <a class="btn btn-sm btn-outline-primary me-1"
                               asp-controller="Products"
                               asp-action="EditVariant"
                               asp-route-productId="@Model.Product.Id"
                               asp-route-id="@v.Id">
                                Sửa
                            </a>

                            <form method="post"
                                  asp-controller="Products"
                                  asp-action="ToggleVariantStatus"
                                  asp-route-productId="@Model.Product.Id"
                                  asp-route-id="@v.Id"
                                  class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit"
                                        class="btn btn-sm @(v.Status == 1 ? "btn-warning" : "btn-success")">
                                    @(v.Status == 1 ? "Ẩn" : "Kích hoạt")
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
